#include <SoftwareSerial.h>

SoftwareSerial BTSerial(11, 10); //RX|TX
SoftwareSerial JoeySerial(13,12);

//int testData[255] = {
//  46,80,76,59,42,27,-2,-35,-16,34,7,-44,32,131,34,-142,-134,-15,7,-34,-45,-66,-87,-51,-15,-26,-28,-17,-24,11,78,55,-7,54,137,51,-91,-86,6,43,36,17,-15,-17,18,24,11,41,62,13,-11,59,107,48,3,
//  65,111,20,-106,-120,-51,-3,11,0,-41,-60,-11,22,-20,-45,-17,-18,-29,27,43,-73,-129,17,137,33,-109,-78,38,77,42,-5,-34,-32,-9,10,19,17,9,28,56,25,-28,17,107,73,-55,-82,10,69,50,12,-28,-54,
//  -27,14,1,-18,9,9,-48,-35,73,113,40,13,77,91,18,-26,-10,-5,-21,-32,-32,-9,40,57,9,-39,-39,-30,-31,5,94,192,240,210,123,30,-47,-103,-111,-70,-47,-70,-93,-89,-75,-45,-9,-18,-54,-32,42,71,35,
//  6,16,47,74,59,1,-34,-16,0,-6,-1,4,-5,18,77,94,65,66,97,105,112,135,131,105,104,103,74,65,78,62,70,159,215,138,38,23,27,13,38,90,113,128,149,129,71,29,11,27,90,133,99,52,51,66,86,121,123,79,
////  56,40,-9,21,188,280,144,-36,-62,-13,-3,-3,17,26,32,59,73,45,11,18,46,43,12,8,42,66,64,52,29,19,52,71,28,7,57,72,18,4,27,-3,0,126,195,64,-85,-77,-24,-41,-56,-23,11,49,103,109,41,-13,-3,18,7,
////  -4,10,22,12,0,16,46,49,16,-11,6,44,52,24,5,4,-4,-7,20,51,60,57,32,-14,-12,35,12,-54,28,222,243,51,-95,-95,-82,-81,-29,13,-13,-22,38,84,64,19,-27,-57,-32,25,33,-3,-8,24,39,33,35,35,21,19,27
////  ,12,-15,-3,37,45,18,0,4,23,49,48,5,-9,42,71,27,-11,-14,-46,-51,72,200,135,-45,-117,-81,-67,-65,-16,20,0,-7,39,75,48,-17,-67,-65,-22,12,11,-4,-9,-7,0,5,-1,-5,14,37,31,0,-16,3,29,31,11,-2,1,14,
////  29,28,4,0,34,48,15,-11,-24,-56,-31,111,204,93,-80,-119,-76,-64,-63,-46,-37,-10,56,79,23,-30,-30,-18,-19,-28,-42,-42,-10,25,33,16,-6,-5,33,58,23,-25,-24,10,35,40,17,-17,-10,28,37,19,4,-11,2,61,
////  80,6,-47,-21,-16,-26,72,199,157,-3,-80,-70,-79,-91,-55,-10,10,18,25,27,28,16,-18,-61,-75,-45,-1,12,5,23,43,13,-26,-6,34,30,12,14,14,12,26,27,-1,-20,-5,26,46,26,-21,-15,50,69,19,-14,-25,-51,-6,144
//  };

int testData[255] =
{
69,27,138,43,149,36,165,32,84,63,106,61,90,4,149,5,138,67,82,34,181,-95,117,-138,50,-70,137,-24,154,-41,10,-73,26,-95,201,-88,149,-57,68,-44,98,-38,154,1,82,33,89,37,134,59,90,73,101,18,101,-24,146,16,153,24,53,-50,90,-70,197,-5,170,27,5,3,13,-30,82,-77,114,-92,134,-36,117,-18,69,-69,89,-41,137,54,117,38,89,-23,98,42,117,102,106,-6,73,-114,181,-60,106,18,53,-2,173,-50,277,-74,18,-79,10,-44,114,2,153,13,164,34,57,62,9,26,86,-14,90,58,26,133,89,53,105,-55,105,-14,109,82,106,70,114,-9,162,-45,69,-37,333,-31,13

};

short heartTestData[255] =
{
0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154
};

byte mHasArrhythmia=0x00;
byte mAmplitude[2];
byte mHeartRate=0x00;

byte output[4];

uint16_t i=0;

void setup(){
  Serial.begin(9600);
  Serial2.begin(9600); // default baud rate
  JoeySerial.begin(9600);
  while(!Serial); //if it is an Arduino Micro
  Serial.println("Karson's output: ");
}

void loop(){
  //read from the HM-10 and print in the Serial
  if(i==255)
  {
    i=0;
  }
  if(JoeySerial.available())
  {
    Serial.write(JoeySerial.read());
  }
//  if(BTSerial.available())
//    Serial.write(BTSerial.read());
//    
//  //read from the Serial and print to the HM-10
//  if(Serial.available())
//  {
//    BTSerial.write(Serial.read());
//  }
  Serial.println(testData[i]);
  int temp = testData[i];
  temp &= 0xFF;
  mAmplitude[0] = testData[i]>>8 & 0xFF;
  mAmplitude[1] = temp;

 int heartrate = heartTestData[i]; //random(255);
 int arryth = 1;
  output[3] = (byte)heartrate; //heart rate
  output[1] = mAmplitude[0];
  output[2] = mAmplitude[1];
  output[0] = (byte)arryth;  //arryhthmia
  //Serial.write(output, 5);
  Serial2.write(output,4);
}
